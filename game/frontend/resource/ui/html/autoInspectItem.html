<html>
	<head>
	</head>
	<body style="background-color: #fff;">
		<script>
// http://stackoverflow.com/questions/901115/how-can-i-get-query-string-values-in-javascript
function getParameterByName(name, url) {
    if (!url) url = window.location.href;
    name = name.replace(/[\[\]]/g, "\\$&");
    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, " "));
}

function ExtractYouTubeId(trailerURL)
{
  if( typeof trailerURL === "undefined" )
    return trailerURL;
  
  var youtubeid;
  if( trailerURL.indexOf("youtube") != -1 && trailerURL.indexOf("v=") != -1 )
  {
    youtubeid = trailerURL.substr(trailerURL.indexOf("v=")+2);

    var found = youtubeid.indexOf("&");
    if( found > -1 )
    {
      youtubeid = youtubeid.substring(0, found);
    }
  }
  else
  {
    var found = trailerURL.indexOf("youtu.be/");
    if( found != -1 )
    {
      youtubeid = trailerURL.substring(found+9);

      found = youtubeid.indexOf("&");
      if( found != -1 )
      {
        youtubeid = youtubeid.substring(0, found);
      }
    }
  }

  return youtubeid;
}

function ExtractTwitchId(trailerURL)
{
    if( typeof trailerURL === "undefined" )
      return trailerURL;

    var twitchid;
    var test = trailerURL;
    var found = test.indexOf("twitch.tv/");
    if( found >= 0 )
    {
      twitchid = test.substr(found + 10);

      found = twitchid.indexOf("/");
      if( found > 0 )
        twitchid = twitchid - twitchid.substring(0, found);
    }

    return twitchid;
}

      function isImageEnding(val)
      {
        var imageEndings = ["jpg", "jpeg", "gif", "png"];
        var extension = val;
        extension = extension.toLowerCase();
        var found = extension.lastIndexOf("/");
        if( found >= 0 )
          extension = extension.substring(found+1);

        found = extension.indexOf("?");
        if( found >= 0)
          extension = extension.substring(0, found);

        found = extension.indexOf("#");
        if( found >= 0)
          extension = extension.substring(0, found);

        found = extension.indexOf(":");
        if( found > 1 )
          extension = extension.substring(0, found);

        found = extension.lastIndexOf(".");
        if( found >= 0 )
          extension = extension.substring(found+1);
        
        return (imageEndings.indexOf(extension) >= 0);
      }

			var preview = decodeURIComponent(getParameterByName("preview"));
			var file = decodeURIComponent(getParameterByName("file"));
			var screen = decodeURIComponent(getParameterByName("screen"));
			var marquee = decodeURIComponent(getParameterByName("marquee"));

      var fieldValue = "";
      if( preview != "")
        fieldValue = preview;
      else if( file.indexOf("http") === 0 )
        fieldValue = file;
      else if( screen != "" )
        fieldValue = screen;
      else if( marquee != "" )
        fieldValue = marquee;

      // FIXME: This needs to pass the php all of its known YouTubeIds, so the player can try them all until it finds one that actually works.

      // prefer preview urls
      var youTubeIds = {};
      var youTubeId;

      youTubeId = ExtractYouTubeId(file);
      if( !!youTubeId )
        youTubeIds["file"] = youTubeId;

      youTubeId = ExtractYouTubeId(preview);
      if( !!youTubeId )
        youTubeIds["preview"] = youTubeId;

      var twitchId = ExtractTwitchId(file);

      if( preview !== "" )
      {
        if( !!youTubeIds["preview"] )
          window.location = "http://smarcade.net/dlcv2/view_youtube.php?id=" + youTubeIds["preview"] + "&autoplay=1";
        else
        {
          if( isImageEnding(fieldValue) )
            window.location = "showImage.html?uri=" + encodeURIComponent(fieldValue);
          else
            window.location = fieldValue;
        }
      }
      else
      {
        if( !!youTubeIds["file"] )
          window.location = "http://smarcade.net/dlcv2/view_youtube.php?id=" + youTubeIds["file"] + "&autoplay=1";
        else if( !!twitchId )
          window.location = "http://www.twitch.tv/" + twitchId + "/popout";
        else
        {
          if( isImageEnding(fieldValue) )
            window.location = "showImage.html?uri=" + encodeURIComponent(fieldValue);
          else
            window.location = fieldValue;
        }
			}
		</script>
	</body>
</html>