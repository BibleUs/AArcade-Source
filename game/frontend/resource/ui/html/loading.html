<html>
	<head>
		<style>
			body
			{
				background-color: #000;
				color: #ccc;
				font-size: 20px;
				margin: 0;
			}

			.mainTitle
			{
				font-size: 40px;
				width: 100%;
				background-color: rgba(50, 50, 50, 0.7);
				text-align: center;
				font-family: Arial;
				padding-top: 10px;
				padding-bottom: 10px;
				font-style: italic;
				text-shadow: 2px 2px 2px #000;
				font-weight: bold;
			}

			.mainTitle div
			{
				display: inline;
			}

			.mainTitle div div
			{
				opacity: 0;
				-webkit-transition: opacity 1s ease-in-out;
			}

			.message
			{
				font-size: 20px;
				width: 70%;
				/*background-color: #333;*/
				/*background-image: -webkit-linear-gradient(left, #555, #555 70%, #333 70%, #333 100%);*/
				border-radius: 20px;
				border: 2px solid #ccc;
				text-align: center;
				font-family: Arial;
				padding-top: 10px;
				padding-bottom: 10px;
				margin-top: 10px;
				margin-bottom: 10px;
				margin-left: auto;
				margin-right: auto;
				font-style: italic;
				text-shadow: 2px 2px 2px #000;
				font-weight: bold;
			}
		</style>

		<script>
			function LoadingManager()
			{
				this.state = 0;
				this.messageContainer;
				this.title = "Loading";
				this.titleNode = null;
				this.messages = new Array();
			}

			LoadingManager.prototype.init = function()
			{
				this.messageContainer = document.body.querySelector("#messageContainer");

				this.titleNode = document.createTextNode(this.title);

				var titleContainer = document.createElement("div");
				titleContainer.className = "mainTitle";
				titleContainer.appendChild(this.titleNode);

				// make the dot dot dot element
				var dotsContainer = document.createElement("div");

				function makeDot(index)
				{
					var dot = document.createElement("div");
					dot.innerText = ".";
					setTimeout(function()
					{
						this.style.opacity = 1.0;
						this.dot = setInterval(function()
						{
							if( this.style.opacity == 0 )
								this.style.opacity = 1.0;
							else
								this.style.opacity = 0.0;
						}.bind(this), 3000);
					}.bind(dot), 1000 * parseInt(index) + 1);

					return dot;
				}

				dotsContainer.appendChild(makeDot(0));
				dotsContainer.appendChild(makeDot(1));
				dotsContainer.appendChild(makeDot(2));

				titleContainer.appendChild(dotsContainer);
				this.messageContainer.appendChild(titleContainer);

				this.state = 1;
				this.dispatchMessages();
			};

			LoadingManager.prototype.setTitle = function(text)
			{
				this.title = text;
				this.titleNode.nodeValue = this.title;
			};

			LoadingManager.prototype.addMessage = function(type, text, title, id, min, max, current)
			{
				var message = {
					"type": type,
					"text": text,
					"title": title,
					"id": id,
					"min": min,
					"max": max,
					"current": current
				};

				this.messages.push(message);

				if( this.state === 1 )
					this.dispatchMessages();
			};

			LoadingManager.prototype.dispatchMessages = function()
			{
				var i, message, container, needsAppend;
				var numMessages = this.messages.length;
				for( i = 0; i < numMessages; i ++ )
				{
					message = this.messages[i];

					needsAppend = false;
					if( message.id !== "" )
						container = document.getElementById("msg" + message.id);
					
					if( !!container )
					{
						// empty out the container
						var firstChild = container.firstChild;
						while( firstChild )
						{
							container.removeChild(firstChild);
							firstChild = container.firstChild;
						}
					}
					else
					{
						container = document.createElement("div");

						if( message.id !== "" )
							container.id = "msg" + message.id;

						needsAppend = true;
					}

					var className;
					if( message.type === "progress" )
					{
						var progressText = "";
						if( message.max !== "" && message.current !== "" )
							progressText += " (" + message.current + "/" + message.max + ")";

						className = "message progress";

						var percent = "0%";
						if( message.max === "0" )
							percent = "100%";
						else if( progressText !== "" )
							percent = Math.floor((parseInt(message.current) / parseInt(message.max)) * 100);

						container.style.backgroundImage = "-webkit-linear-gradient(left, rgba(100, 100, 100, 1.0), rgba(100, 100, 100, 1.0) " + percent + "%, rgba(50, 50, 50, 0.7) " + percent + "%, rgba(50, 50, 50, 0.7) 100%)";
						container.innerText = message.title + progressText;
					}
					else
					{
						className = "message";
						container.innerText = message.text;
					}

					container.className = className;

					if( needsAppend )
						this.messageContainer.appendChild(container);
				}

				this.messages = this.messages.splice(numMessages);
			};

			var loadingManager = new LoadingManager();
		</script>
	</head>
	<body>
		<div id="messageContainer"></div>
		<a href="javascript:location.reload();">Hello World.</a>
		<script>
			loadingManager.init();
			/*
			loadingManager.setTitle("Anarchy Arcade - Starting Up");
			loadingManager.addMessage("progress", "", "Detecting Workshop Subscriptions", "work", "0", "10", "5");

			setTimeout(function()
			{
				loadingManager.addMessage("progress", "", "Detecting Workshop Subscriptions", "work", "0", "10", "8");

				setTimeout(function()
				{
					loadingManager.addMessage("progress", "", "Detecting Workshop Subscriptions", "work", "0", "10", "9");

					setTimeout(function()
					{
						loadingManager.addMessage("progress", "", "Detecting Workshop Subscriptions", "work", "0", "10", "10");
					}, 3000);
				}, 3000);
			}, 3000);
			*/
		</script>
	</body>
</html>